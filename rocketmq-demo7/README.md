# 集群消费和广播消费（主要广播消息）


在消费者中消费组的有非常重要的作用，如果多个消费者设置了相同的Consumer Group，我们认为这些消费者在同一个消费组内。 

在 Apache RocketMQ 有两种消费模式，分别是：

* 集群消费模式：当使用集群消费模式时，RocketMQ 认为任意一条消息只需要被消费组内的任意一个消费者处理即可。
* 广播消费模式：当使用广播消费模式时，RocketMQ 会将每条消息推送给消费组所有的消费者，保证消息至少被每个消费者消费一次。



## 集群消费模式

适用于每条消息只需要被处理一次的场景，也就是说整个消费组会Topic收到全量的消息，而消费组内的消费分担消费这些消息，因此可以通过扩缩消费者数量，来提升或降低消费能力，具体示例如下图所示，是最常见的消费方式。

![集群消费模式.png](./doc/image/集群消费模式.png)

## 广播消费模式

适用于每条消息需要被消费组的每个消费者处理的场景，也就是说消费组内的每个消费者都会收到订阅Topic的全量消息，因此即使扩缩消费者数量也无法提升或降低消费能力，具体示例如下图所示。

![广播消费模式.png](./doc/image/广播消费模式.png)


<br>

> 注意：广播模式消息消费失败后就不会重新消费了，相当于丢弃了消息。

<br>

## RocketMQ同一消费组消费完成后，消息会删除吗

RocketMQ在同一消费组消费完成后，默认情况下不会立即删除消息。消息删除的具体行为取决于消息的消费模式和消息的确认方式。

对于集群消费模式，消息将在被任何一个消费者成功消费并确认后，立即被标记为已删除。因此，在集群模式下，消息只需要被任意一个消费者成功处理即可删除。

对于广播消费模式，消息将在被所有消费者都消费完成后，才会被标记为已删除。这意味着只有当所有消费者都成功消费并确认了消息后，消息才会被删除。

需要注意的是，RocketMQ提供了多种消息确认方式，包括自动确认和手动确认。如果使用手动确认方式，在消息被处理后，需要显式地调用确认方法来通知RocketMQ该消息已经成功处理。只有在消息被确认后，RocketMQ才会将其标记为已删除。

综上所述，RocketMQ同一消费组消费完成后，默认情况下消息不会立即删除，而是根据消费模式和确认方式的不同来确定消息删除的时机。
